var route,nrList=[],nrUsers=[],nrListPrivate=[],nrListNum=14,nrUserNum=99,nrMaxUserPerRound=6,loggedIn=!1;function subheaderUpdate(){0==$("section[ref=nrNew]").hasClass("hidden")?$("body").addClass("subheader-hidden"):0==$("section[ref=nrNotifications]").hasClass("hidden")?$("body").addClass("subheader-hidden"):$("section[ref=nrHome]").hasClass("hidden")?$("body").addClass("subheader-hidden"):$("body").removeClass("subheader-hidden")}function renderUser(e){console.log(e);var n,r;for($("[ref=nrUserView] .user-view").remove(),$("[ref=nrUserView]").find("div.template").clone().removeClass("template hidden").addClass("user-view").appendTo("[ref=nrUserView]"),n=nrUsers,i=0;i<n.length;i++)if(e==n[i][0]){for(r=i,i=0;i<5;i++)4===i?$("section[ref=nrUserView] .user-view span[ref=user-view-"+i+"]").html('<span class="avatar"><img src="'+n[r][i-1]+'"></span>'):$("section[ref=nrUserView] .user-view span[ref=user-view-"+i+"]").html(n[r][i-1]);return!1}}function renderRecord(e,n){var r,t,s,a="";for($("section[ref=nrRecordView] .record-view").remove(),$("section[ref=nrRecordView]").find("div.template").clone().removeClass("template hidden").addClass("record-view").appendTo("section[ref=nrRecordView]"),r=0==n?nrList:nrListPrivate,i=0;i<r.length;i++)if(e==r[i][0]){for(t=i,i=0;i<20;i++)3===i?$("section[ref=nrRecordView] .record-view span[ref=record-view-"+i+"]").html(nrDrinkTypeWidget(r[t][i])):10===i?(nrLocationMap(r[t][i]),$("section[ref=nrRecordView] .record-view span[ref=record-view-"+i+"]").html(r[t][i])):19===i?(r[t][i].forEach(function(e){console.log(e),s=queryObject(nrUsers,e,1),a+='<a href="" class="avatar" ref="nrUser" data-id="'+queryObject(nrUsers,e,0)+'"><img src="'+queryObject(nrUsers,e,3)+'">'+s+"</a>"}),$("section[ref=nrRecordView] .record-view span[ref=record-view-"+i+"]").html(a)):$("section[ref=nrRecordView] .record-view span[ref=record-view-"+i+"]").html(r[t][i]);return!1}}function nrLocationMap(e){$('<div style="background: url(img/mappreload.png);text-decoration:none; overflow:hidden; height:300px; width:100%; max-width:100%;">                        <div id="my-map-display" style="height:100%; width:100%;max-width:100%;">                        <iframe style="height:100%;width:100%;border:0;" frameborder="0" src="https://www.google.com/maps/embed/v1/place?q='+e+'&key=AIzaSyAN0om9mFmy1QN6Wf54tXAowK4eT0ZUPrU"></iframe>                        </div>                    </div>').appendTo($("section[ref=nrRecordView] .record-view span[ref=record-view-map]"))}function nrRoute(e){"home"==e&&($("[ref=nrHome]").removeClass("hidden"),setTimeout(function(){$(".fake-list-view, .list-view").toggleClass("hidden")},1200))}function fakeListGlobalFilter(){var e=0;nrList.forEach(function(n){$("[ref=nrRadiusRange]").prop("value")<n[1]||0==$(".subheader .drink-widget .drinks .btn[data-value="+n[3]+"]").hasClass("active")||$("[ref=nrHowSoonRange]").prop("value")<n[2]?nrList[e][6]=!0:nrList[e][6]=!1,e++}),fakeListGenerate("[ref=nrHome] ul.ul-list-view")}function fakeListViewDrinkType(e,n){1==n?$(".list-view ul li[data-drinktype="+e+"]").removeClass("hidden"):$(".list-view ul li[data-drinktype="+e+"]").addClass("hidden")}function fakeListViewFilterRadius(e){$(".list-view ul.ul-list-view li").each(function(n){$(this).attr("data-distance")>e?$(this).addClass("hidden"):$(this).removeClass("hidden")})}function fakeListGenerate(e){var n="";if("[ref=nrHome] ul.ul-list-view"==e)var r=[].concat(nrList);else if("[ref=nrMyRounds] ul.ul-list-view"==e)r=[].concat(nrListPrivate);r.forEach(function(e){1!=e[6]&&(n+="<li ",n+=' hidden="'+e[6]+'" ',n+="data-sponsored="+e[20]+" ",n+='data-distance="'+e[1]+'" data-drinktype="d'+e[3]+'" data-daysaway="'+e[2]+'" ',n+=">",n+="<a ",n+='new-round-id="'+e[0]+'" ref="nrRecordView" class="swipe-round swipe-round ui-btn" href="#">',n+="<span>",n+='<embed src="img/',"d1"===e[3]?n+="wine":"d2"===e[3]?n+="beer":"d3"===e[3]?n+="cocktail":"d4"===e[3]&&(n+="hard"),n+='.svg" type="image/svg+xml" class="svg"> ',1==e[20]&&(n+='<span style="position: absolute; top: -16px; left: 1px; height: 18px; overflow: hidden;"><span style="font-size: 10px; position: relative; top: -7px;">sponsored by:</span> <img style="height:20px;" src="'+e[21]+'"></span>'),n+='<strong class="username strtolower">'+e[5]+'</strong class="username pull-right"> started <strong class="roundname">"'+e[4]+'"</strong>; in '+e[2]+" days, "+e[1]+" miles from you",n+="</span>",n+='<span class="users pull-right">',n+='<i class="fa fa-user"></i><i class="fa fa-user"></i><i class="fa fa-user"></i><i class="fa fa-user"></i><i class="fa fa-user"></i><i class="fa fa-user"></i>',n+="</span>",n+="</a>",n+="</li>")}),$(e).html(n)}function randomInt(e,n){return Math.floor(Math.random()*(n-e+1)+e)}function nrDrinkWidget(e,n){var r='<div class="drinks">        <div class="btn-group" data-widget-type="'+e+'">        <div class="btn pull-left" data-value="d2"><embed src="img/beer.svg" type="image/svg+xml" class="svg pull-left"> <span class="pull-left">beer</span></div>        <div class="btn pull-left" data-value="d1"><embed src="img/wine.svg" type="image/svg+xml" class="svg pull-left"> <span class="pull-left">wine</span></div>        <div class="btn pull-left" data-value="d3"><embed src="img/cocktail.svg" type="image/svg+xml" class="svg pull-left"> <span class="pull-left">cocktail</span></div>        <div class="btn pull-left" data-value="d4"><embed src="img/hard.svg" type="image/svg+xml" class="svg pull-left"> <span class="pull-left">hard stuff</span></div>    </div>            </div>    ';$(n).html(r),".subheader .drink-widget"==n&&$(n).find(".btn").addClass("active")}function nrDrinkTypeWidget(e,n){var r="<div>";return"d1"==e?r+='<span class="optional">wine</span>        <embed src="img/wine.svg" type="image/svg+xml" class="svg" drink-type="d2">        ':"d2"==e?r+='<span class="optional">beer</span>        <embed src="img/beer.svg" type="image/svg+xml" class="svg" drink-type="d2">        ':"d3"==e?r+='<span class="optional">cocktail</span>        <embed src="img/cocktail.svg" type="image/svg+xml" class="svg" drink-type="d2">        ':"d4"==e&&(r+='<span class="optional">hard stuff</span>        <embed src="img/hard.svg" type="image/svg+xml" class="svg" drink-type="d2">        '),r+="</div>"}function nrDrinkTypeImg(e){var n;return"d1"==e?n="wine.svg":"d2"==e?n="beer.svg":"d3"==e?n="cocktail.svg":"d4"==e&&(n="hard.svg"),n}function queryObject(e,n,r){var i,t=0;return e.forEach(function e(r){e.stop||(r[0]==n&&(i=t,e.stop=!0),t++)}),e[i][r]}$(document).on("pagecreate","#demo-page",function(){1==loggedIn&&n();timer=setInterval(function(){console.log("wake up and check if notifications must be pushed")},112e9);timer=setInterval(function(){var e,n=randomInt(1,4);1===n?nrListPrivate.length>0&&nrMaxUserPerRound>nrListPrivate.length&&(roundPointer=randomInt(0,nrListPrivate.length-1),e=randomInt(0,nrUsers.length-1),nrListPrivate[roundPointer][19].length,nrListPrivate[roundPointer][0],nrUsers[e][0],nrMaxUserPerRound>nrListPrivate[roundPointer][19].length&&r(e,roundPointer,"private")):4===n&&(roundPointer=randomInt(0,nrList.length-1),e=randomInt(0,nrUsers.length-1),nrList[roundPointer][19].length,nrList[roundPointer][0],nrUsers[e][0],nrMaxUserPerRound>nrList[roundPointer][19].length&&r(e,roundPointer,"public"))},5e3);timer=setInterval(function(){console.log("generating new public rounds ")},1e5);var e=function(){console.log("sync up all publicly displayed list views with joined users"),nrListPrivate.forEach(function(e){$("a[new-round-id="+e[0]+"] .users").attr("data-joined","u"+e[19].length)}),nrList.forEach(function(e){$("a[new-round-id="+e[0]+"] .users").attr("data-joined","u"+e[19].length)})};function n(){var e=randomInt(1,6);for(t(!1),route||nrRoute("home"),i=0;i<nrListNum;i++)e===i?nrList.push([faker.random.uuid(),24,2,"d2","Irish night!","St. Stephen's Green",!1,"Aug 1 2016","8pm","11pm","223 Castro St. Mountain View, CA",6,"","","","","","",!1,[],!0,"http://i.imgur.com/p2t2loY.png"]):nrList.push([faker.random.uuid(),randomInt(0,100),randomInt(0,30),"d"+randomInt(1,4),faker.hacker.ingverb(),faker.internet.userName(),!1,"","","",faker.address.city()+", "+faker.address.state(),"","","","","","","",!1,[],!1,""]);for(i=0;i<nrUserNum;i++)nrUsers.push([faker.random.uuid(),faker.internet.userName(),faker.internet.email(),faker.internet.avatar()]);fakeListGenerate("[ref=nrHome] ul.ul-list-view"),nrDrinkWidget("checkbox",".subheader .drink-widget"),$("body").addClass("authenticated")}function r(e,n,r){var i;(i="public"==r?nrList:nrListPrivate)[n][19].push(nrUsers[e][0]);var s,a,o=nrUsers[e][0],d=i[n][0];"private"==r&&(t(1),s='<a href="">User '+queryObject(nrUsers,o,1)+" joined your round ("+queryObject(i,d,0)+")</a>",a=$("section[ref=nrNotifications] ul[ref=nrNotificationsList]"),$('<li class="unread notification">'+s+"</li>").prependTo(a)),queryObject(nrUsers,o,1)}function t(e){var n,r,i=$("span[ref=alertNum]");if(0==e)return 0===parseInt(i.attr("data-num"))?i.addClass("inactive"):i.removeClass("inactive"),!1;e<0?(n=parseInt(i.attr("data-num"))-1,r="unflash"):(n=parseInt(i.attr("data-num"))+1,r="flash"),i.html(n).attr("data-num",n).removeClass("inactive"),i.addClass(r),setTimeout(function(){i.removeClass(r)},100)}timer=setInterval(e,5e3),$(document).on("click","#nr-login [ref=nrLoginButton]",function(){n()}),$(document).on("swipeleft swiperight","#demo-page",function(e){if($("body").addClass("swiped"),setTimeout(function(){$("body").removeClass("swiped")},310),$(e.target).attr("class").match(/swipe-round/g))return"swiperight"===e.type?($(e.target).closest("li").addClass("swiped-right"),setTimeout(function(){$(e.target).closest("li").addClass("ready")},310)):($(e.target).closest("li").addClass("swiped-left"),setTimeout(function(){$(e.target).closest("li").removeClass("swiped-right swiped-left ready")},600)),!1;"open"!==$(".ui-page-active").jqmData("panel")&&"swiperight"===e.type&&$("#left-panel").panel("open")}),$(document).on("swipedown","section[ref].swipe-up-down h4",function(e){var n=$(this);n.closest("section[ref].swipe-up-down").addClass("swiped-down"),setTimeout(function(){$(n).closest("section.swipe-up-down").removeClass("swiped-down").addClass("hidden")},200)}),$(document).on("keydown","[ref=nrFindAround]",function(e){return $(".ui-input-search > input").attr("value",$(e.target).val()),!1}),$(document).on("click",".subheader > div[ref]",function(e){if($(this).hasClass("active"))return $(this).removeClass("active").closest(".subheader").find("aside").find("div[ref="+$(this).attr("ref")+"]").addClass("hidden"),!1;$(this).siblings("div").removeClass("active"),$(this).closest(".subheader").find("aside").find("div[ref]").addClass("hidden"),$(this).addClass("active").closest(".subheader").find("aside").find("div[ref="+$(this).attr("ref")+"]").removeClass("hidden")}),$(document).on("click","[ref=nrNotificationsToggle]",function(){$("[ref=alertNum]").trigger("click")}),$(document).on("click","[ref=alertNum]",function(){$("section[ref=nrNotifications]").toggleClass("hidden"),$("section[ref=nrNotifications]").hasClass("hidden")?$("body").removeClass("notifications-active"):$("body").addClass("notifications-active"),subheaderUpdate()}),$(document).on("click","ul[ref=nrNotificationsList] li.unread.notification",function(){return $(this).removeClass("unread"),t(-1),t(!1),!1}),$(document).on("click","li.swiped-right.ready",function(){return $(this).closest("li").remove(),!1}),$(document).on("click","[ref=nrNewToggle]",function(){return $("section[ref=nrNew] section.new-round-view").remove(),$("section[ref=nrNew]").find("section.template").clone().removeClass("template hidden").addClass("new-round-view").appendTo("section[ref=nrNew]"),$("[ref=nrNew]").toggleClass("hidden"),$("[ref=nrNew]").hasClass("hidden")?$("body").removeClass("modal-active"):$("body").addClass("modal-active"),subheaderUpdate(),!1}),$(document).on("click","body:not(.swiped) .list-view a[ref=nrRecordView]",function(){var e=!1;return $(".ui-content > section[ref=nrRecordView]").removeClass("hidden"),$("[ref=nrRecordView] > div > span[round-id]").html($(this).attr("new-round-id")),"nrMyRounds"==$(this).closest("section").attr("ref")&&(e=!0),renderRecord($(this).attr("new-round-id"),e),subheaderUpdate(),!1}),$(document).on("click","[ref=nrUser]",function(){var e=$(this).attr("data-id");return $(".ui-content > section[ref=nrUserView]").removeClass("hidden"),renderUser(e),subheaderUpdate(),!1}),$(document).on("change","[ref=nrRadiusRange]",function(e){setTimeout(function(){fakeListGlobalFilter()},300)}),$(document).on("change","[ref=nrHowSoonRange]",function(e){setTimeout(function(){fakeListGlobalFilter()},300)}),$(document).on("click",".subheader .drink-widget .drinks .btn",function(e){var n=$(this).attr("data-value"),r=$(this).hasClass("active");setTimeout(function(){fakeListGlobalFilter(),1==r?$("[ref=nrDrink] .svg[drink-type="+n+"]").addClass("hidden"):$("[ref=nrDrink] .svg[drink-type="+n+"]").removeClass("hidden")},300)}),$(document).on("click","[ref=nrDrinkTypeFilter] label",function(e){var n=$(this);setTimeout(function(){fakeListGlobalFilter(),$(n).hasClass("ui-checkbox-off")?$("[ref=nrDrink] .svg[drink-type="+$(n).attr("drink-type")+"]").addClass("hidden"):$("[ref=nrDrink] .svg[drink-type="+$(n).attr("drink-type")+"]").removeClass("hidden")},300)}),$(document).on("change","[ref=nrHowSoonRange]",function(){return $(".subheader > div[ref=nrHowSoon] > span").html($(this).prop("value")),!1}),$(document).on("change","[ref=nrRadiusRange]",function(){return $(".subheader > div[ref=nrRadius] > span").html($(this).prop("value")),!1}),$(document).on("click","nav > a[noref=nrLogout]",function(){loggedIn=!1,$("body").removeClass("authenticated"),$("[ref=nrHome] .list-view, [ref=nrHome] .fake-list-view").toggleClass("hidden"),$("[ref=nrMyRounds] .list-view, [ref=nrMyRounds] .fake-list-view").toggleClass("hidden")}),$(document).on("click","nav > a[ref]",function(){var n=$(this).attr("ref");return $("div[role=main].ui-content > section").addClass("hidden"),$("div[role=main].ui-content > section[ref="+n+"]").removeClass("hidden"),$(".ui-panel-dismiss-open").trigger("swipeleft"),fakeListGenerate("[ref="+n+"] ul.ul-list-view"),subheaderUpdate(),e(),!1}),$(document).on("click",".footer [ref=nrShortcutHome]",function(){return $("nav [ref=nrHome]").trigger("click"),!1}),$(document).on("click",".footer [ref=nrShortcutNotifications]",function(){return $("[ref=alertNum]").trigger("click"),!1}),$(document).on("click",".drink-widget .btn",function(){var e=$(this).closest(".btn-group").attr("data-widget-type");"radio"==e?($(this).closest(".btn-group").find(".btn").removeClass("active"),$(this).addClass("active")):"checkbox"==e&&$(this).toggleClass("active")}),$(document).on("click","[ref=nrNewRoute]",function(){var e=$(this).attr("route-action"),n=$(this).closest("section").attr("class");return"nr-new-1"==n&&"next"==e?($(".new-round-view section.nr-new-1, .new-round-view section.nr-new-2").toggleClass("hidden"),nrDrinkWidget("radio",".nr-new-2 .drink-widget")):"nr-new-2"==n&&"next"==e?$(".new-round-view section.nr-new-2, .new-round-view section.nr-new-3").toggleClass("hidden"):"nr-new-2"==n&&"back"==e?$(".new-round-view section.nr-new-1, .new-round-view section.nr-new-2").toggleClass("hidden"):"nr-new-3"==n&&"back"==e?$(".new-round-view section.nr-new-2, .new-round-view section.nr-new-3").toggleClass("hidden"):"nr-new-3"==n&&"next"==e&&(nrListPrivate.push([faker.random.uuid(),parseInt($("[ref=nrNew] .new-round-view [ref=nrInputInviteRange]").prop("value")),randomInt(0,30),$("[ref=nrNew] .new-round-view .drink-widget .btn.active").attr("data-value"),"TBD","TBD",!1,$("[ref=nrNew] .new-round-view [ref=nrInputDate]").prop("value"),$("[ref=nrNew] .new-round-view [ref=nrInputStartTime]").prop("value"),$("[ref=nrNew] .new-round-view [ref=nrInputEndTime]").prop("value"),$("[ref=nrNew] .new-round-view [ref=nrInputLocation]").prop("value"),$("[ref=nrNew] .new-round-view [ref=nrInputLimit]").prop("value"),$("[ref=nrNew] .new-round-view [ref=nrInputDrink]").prop("value"),$("[ref=nrNew] .new-round-view [ref=nrInputNotes]").prop("value"),$("[ref=nrNew] .new-round-view [ref=nrInputInviteRange]").prop("value"),$("[ref=nrNew] .new-round-view [ref=nrInputGettingSocial]").prop("value"),"",$("[ref=nrNew] .new-round-view [ref=nrInputTextPage]").prop("value"),$("[ref=nrNew] .new-round-view [ref=nrRoundPrivate]").hasClass("ui-btn-active"),[]]),$("nav [ref=nrMyRounds]").trigger("click")),!1})});