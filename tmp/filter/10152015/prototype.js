$(document).ready(function(){function e(e){e?($(".filter-header-container, .filter-rows-container.filter-basic").toggle(),$(".filter-rows-container.filter-basic .filter-definition-container").attr("id","id"+Math.floor(110*Math.random()+1)).empty().html(filter_controls_advanced_labels+filter_controls_advanced_row),s(filter_tool_obj),$(".filter-rows-container.filter-advanced").html(filter_controls_advanced_query),$(".header-components").empty().html(filter_header_components),0===$("[ref=filterBasicRowContainerModel]").length&&$(".filter-rows-container.filter-basic").find("[ref=filterBasicRowContainer]").attr("group","1").addClass("last-group").clone().insertAfter("[ref=filterBasicRowContainer]").addClass("model hidden").attr("ref","filterBasicRowContainerModel").removeClass("last-group"),o(),n()):$(".filter-header-container, .filter-rows-container").hide()}function t(e){$(".filter-basic, .filter-advanced").toggle(),e.html("Advanced"==e.text()?"Basic":"Advanced")}function l(e,t,l){var s="",a=0,i=($(t).closest(".filter-definition-container").attr("id"),"");t.selector.indexOf("row-one")>0?i="fakeSelect2liClickRow1":t.selector.indexOf("row-two")>0?i="fakeSelect2liClickRow2":t.selector.indexOf("row-three")>0?i="fakeSelect2liClickRow3":t.selector.indexOf("row-operator-details")>0&&(i="fakeSelect2liClickRowOperator"),e.forEach(function(e){s=s+'<li ref="'+i+'" objindex="'+a++ +'" data="'+e+'" class="select2-results-dept-0 select2-result select2-result-selectable" role="presentation"><div class="select2-result-label" id="select2-result-label-75" role="option"><span class="select2-match"></span>'+e+"</div></li>"}),$(t).after().siblings().hasClass("fake-select2")&&console.log("duplicate fake select2 menu found"),$(t).before(filter_fake_select2_before+s+filter_fake_select2_after),l&&$(t).prev(".fake-select2").removeClass("hidden"),$(t).find("input").addClass("fake-select2-input")}function s(e){var t=[],s=$(".details.row-one");$.each(e,function(e,l){t.push(l.name)}),l(t,s,!1),s.find("input:first").after('<a class="fake-select2-dropdown" ref="fakeSelect2dropdown"><i class="fa fa-sort-down"></i>')}function a(e,t){var s=[],a=$("#"+t+" .details.row-two");$.each(e.selectOperator,function(e,t){s.push(t)}),$("#"+t+" .details.row-two").prev(".fake-select2").remove(),l(s,a),a.find("input:first").after('<a class="fake-select2-dropdown" ref="fakeSelect2dropdown"><i class="fa fa-sort-down"></i>')}function r(e,t){var s=[],a=$("#"+t+" .details.row-three");$.each(e.selectValue,function(e,t){s.push(t)}),$("#"+t+" .details.row-three").prev(".fake-select2").remove(),l(s,a),a.find("input:first").after('<a class="fake-select2-dropdown" ref="fakeSelect2dropdown"><i class="fa fa-sort-down"></i>')}function o(){$.each($($(".filter-definition-container")),function(){$(this).attr("id","id"+Math.floor(110*Math.random()+1))})}function n(){var e=0;$.each($($("[ref=filterBasicRowContainer] input[index]")),function(){$(this).attr("index",e++)})}function c(){var e=1;$.each($($("[ref=filterBasicRowContainer]")),function(){$(this).attr("rowIndex",e++)})}function d(){var e="SELECT * FROM myTable WHERE ",t=0,l=0;return indexNum=$("[ref=filterBasicRowContainer] input[index]").length,queryGroupUnion="",$.each($($("[ref=filterBasicRowContainer] input[index]")),function(){$(this).hasClass("query-group-union")===!0&&(queryGroupUnion=$(this).attr("data")),$(this).hasClass("query-group-union")===!1&&(e=e+" "+$(this).attr("data")),t++,l++,3===t&&indexNum!=l&&(t=0),l===indexNum&&(e=e.replace(/\)/g,") "+queryGroupUnion),e=e.replace(/\( /g,"(").replace(/ \)/g,")").replace(/  \(/g," (").slice(0,-queryGroupUnion.length))}),e}function f(e){$.each($(".operator:visible"),function(){if(0===$(this).find(".details.row-operator-details").prev(".fake-select2").length){l(filter_tool_operators,$(this).find(".details.row-operator-details"),!1);var t="";t=0==e?"query-group-union":"rows-group",$(this).find("input:visible").val("AND").attr({data:"AND",index:0}).addClass(t).after('<a class="fake-select2-dropdown" ref="fakeSelect2dropdown"><i class="fa fa-sort-down"></i>')}}),console.log("not done yet")}function u(){var e,t=$("[ref=filterBasicRowContainer]").last().attr("group"),l=$("[ref=filterBasicRowContainer]").last().attr("group");for(i=0;i<t;i++)$("[ref=filterBasicRowContainer][group="+(i+1)+"]").removeClass("last-of-group last-child-of-group").last().addClass("last-of-group"),$("[ref=filterBasicRowContainer][group="+(i+1)+"]").removeClass("first-of-group").first().addClass("first-of-group"),parseInt(t)===i+1&&$("[ref=filterBasicRowContainer][group="+(i+1)+"]").last().addClass("last-child-of-group"),$("[ref=filterBasicRowContainer][group="+(i+1)+"]").first().attr("group-size",+$("[ref=filterBasicRowContainer][group="+(i+1)+"]").length),e=$("[ref=filterBasicRowContainer][group="+(i+1)+"]").length,$("[ref=filterBasicRowContainer][group="+(i+1)+"]").first().find(".operator.row-operator").find(".row-operator-details").css({height:38*e+4+"px"}).find(".fake-select2-input").toggleClass("translatez");if(t>1)for($("[ref=filterBasicRowContainer]").addClass("insert-group-union"),$("[ref=filterBasicRowContainer]").first().find(".filter-group-union.operator").css({height:38*$("[ref=filterBasicRowContainer]").length+16+20*l+"px"}),$(".group-wrap").remove(),i=1;i<=t;i++)$('<input class="group-wrap" data="(" type="hidden" index/>').prependTo($("[ref=filterBasicRowContainer][group="+i+"]").first().find(".filter-definition-container")),$('<input class="group-wrap" data=")" type="hidden" index/>').appendTo($("[ref=filterBasicRowContainer][group="+i+"]").last().find(".filter-definition-container")),n();else $("[ref=filterBasicRowContainer]").removeClass("insert-group-union");$("[ref=filterBasicRowContainer]").removeClass("last-group"),$("[group="+t+"]").addClass("last-group")}$("#newcontent").find(".search-filter.filter-dropdown-h").after(filter_dropdown),$(".select2.search-filter").click(function(){$(".filter-dropdown-container").toggle()}),$("[ref=newFilter]").click(function(){$(".filter-dropdown-container").toggle(),e(!0)}),$("[ref=newFilterLabel]").click(function(){1!=$(this).hasClass("read-only")&&e(!0)}),$(document).on("click","[ref=newFilterCancel], [ref=filterClose]",function(){e(!1),$("#newcontent .search-filter").find("input").val(""),$("[ref=filterSave]").addClass("disabled"),$("[ref=newFilterLabel]").html("New filter").removeClass("read-only"),$("[ref=newFilterCancel]").addClass("hidden"),$("[ref=filterBasicRowContainer]:not(:first-child)").remove(),$("[ref=filterBasicRowContainer]").removeClass("grouped")}),$(document).on("click","[ref=filterAdvanced]",function(){t($(".filter-option-advanced"));var e=d();return $("[ref=queryInput]").val(e).attr("data",e),!1}),$(document).on("click","[ref=filterClear]",function(){$("#newcontent .search-filter").find("input").val(""),$("[ref=filterSave]").addClass("disabled"),$("[ref=newFilterLabel]").html("New filter").removeClass("read-only"),$("[ref=newFilterCancel]").addClass("hidden"),$("[ref=filterBasicRowContainer]").remove(),$("[ref=filterBasicRowContainerModel]").clone().insertBefore("[ref=filterBasicRowContainerModel]").removeClass("model hidden").attr("ref","filterBasicRowContainer"),o()}),$(document).on("click","[ref=filterRowPlusGroup]",function(e){group=parseInt($(e.currentTarget).closest("[ref=filterBasicRowContainer]").attr("group"))+1,$("[ref=filterBasicRowContainerModel]").clone().insertAfter($(e.currentTarget).closest("[ref=filterBasicRowContainer]").closest("[ref=filterBasicRowContainer]")).removeClass("hidden model").attr({ref:"filterBasicRowContainer",group:group}),o(),n(),c(),u(),f(!1)}),$(document).on("click","[ref=filterRowPlus]",function(e){group=$(e.currentTarget).closest("[ref=filterBasicRowContainer]").attr("group"),$("[ref=filterBasicRowContainerModel]").clone().insertAfter($(e.currentTarget).closest("[ref=filterBasicRowContainer]")).removeClass("hidden model").addClass("grouped").attr({ref:"filterBasicRowContainer",group:group}).prev("[ref=filterBasicRowContainer]").addClass("grouped"),o(),n(),c(),u(),f()}),$(document).on("click","[ref=filterRowMinus]",function(e){1==$("[ref=filterBasicRowContainer]").length?$("[ref=filterClose]").trigger("click"):(group=$(e.currentTarget).closest("[ref=filterBasicRowContainer]").attr("group"),groupedCount=$("[ref=filterBasicRowContainer][group="+group+"]").length,2===groupedCount&&$("[ref=filterBasicRowContainer][group="+group+"]").removeClass("grouped"),$(this).closest("[ref=filterBasicRowContainer]").remove()),n(),c(),u()}),$(document).on("click","[ref=fakeSelect2dropdown], .fake-select2-input",function(){$(this).closest(".details").prev().toggleClass("hidden")}),$(document).on("click","[ref=fakeSelect2liClickRow1]",function(){$(this).closest(".fake-select2").toggleClass("hidden"),$(this).closest(".fake-select2").next(".details").find("input").val($(this).attr("data")).attr("data",$(this).attr("data"));var e=$(this).closest(".filter-definition-container").attr("id"),t=$(this).attr("objindex");$(this).closest("[ref=filterBasicRowContainer]").attr("filter_tool_obj_store",t),a(filter_tool_obj[$(this).attr("objindex")],e)}),$(document).on("click","[ref=fakeSelect2liClickRow2]",function(){$(this).closest(".fake-select2").toggleClass("hidden"),$(this).closest(".fake-select2").next(".details").find("input").val($(this).attr("data")).attr("data",$(this).attr("data"));var e=$(this).closest(".filter-definition-container").attr("id");filter_tool_obj_store=$(this).closest("[ref=filterBasicRowContainer]").attr("filter_tool_obj_store"),r(filter_tool_obj[filter_tool_obj_store],e)}),$(document).on("click","[ref=fakeSelect2liClickRow3]",function(){$(this).closest(".fake-select2").toggleClass("hidden"),$(this).closest(".fake-select2").next(".details").find("input").val($(this).attr("data")).attr("data",$(this).attr("data"));$(this).closest(".filter-definition-container").attr("id")}),$(document).on("click","[ref=fakeSelect2liClickRowOperator]",function(){$(this).closest(".fake-select2").toggleClass("hidden"),$(this).closest(".fake-select2").next(".details").find("input").val($(this).attr("data")).attr({data:$(this).attr("data"),index:"null"}),n()}),$("#newcontent").on("change keyup","[ref=newFilterName]",function(e){{var t=e.currentTarget.value;e.handleObj.type}$("[ref=newFilterLabel]").html(t).addClass("read-only"),$("[ref=newFilterCancel]").removeClass("hidden"),""==!t?$("[ref=filterSave]").removeClass("disabled"):($("[ref=filterSave]").addClass("disabled"),$("[ref=newFilterLabel]").html("New filter").removeClass("read-only"),$("[ref=newFilterCancel]").addClass("hidden"))})});var filter_tool_operators=["AND","OR"],filter_tool_obj={0:{name:"State",type:"select2",selectOperator:["is","is not"],selectValue:["AK","AL","AR","AZ","CA","CO","CT","DC","DE","FL","GA","HI","IA","ID","IL","IN","KS","KY","LA","MA","MD","ME","MI","MN","MO","MS","MT","NC","ND","NE","NH","NJ","NM","NV","NY","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VA","VT","WA","WI","WV","WY"]},1:{name:"Assigned to",type:"select2",selectOperator:["is","is not"],selectValue:["Admin","Will","Sally"]},2:{name:"Probability",type:"select2",selectOperator:["equals to","doesn't equal to","near"],selectValue:["1","2","3","4","5","6","7","8","9"]},3:{name:"Likelihood",type:"select2",selectOperator:["is greater than","is less than","about"],selectValue:["25%","50%","75%","100"]},4:{name:"Name",type:"select2",selectOperator:["exactly matches","starts with","contains"],selectValue:[null]},5:{name:"Type",type:"select2",selectOperator:["is any of","is not any of","is empty","is not empty"],selectValue:[null]},6:{name:"Type",type:"select2",selectOperator:["is any of","is not any of","is empty","is not empty"],selectValue:[null]},7:{name:"Industry",type:"select2",selectOperator:["is any of","is not any of","is empty","is not empty"],selectValue:[null]},8:{name:"Annual Revenue",type:"select2",selectOperator:["exactly matches","starts with"],selectValue:[null]},9:{name:"Street",type:"select2",selectOperator:["exactly matches","starts with"],selectValue:[null]},10:{name:"City",type:"select2",selectOperator:["exactly matches","starts with"],selectValue:[null]},11:{name:"Postal Code",type:"select2",selectOperator:["exactly matches","starts with"],selectValue:[null]},12:{name:"Country",type:"select2",selectOperator:["exactly matches","starts with"],selectValue:[null]},13:{name:"Rating",type:"select2",selectOperator:["exactly matches","starts with"],selectValue:[null]},12:{name:"My Favirites",type:"select2",selectOperator:[null],selectValue:[null]}},filter_dropdown=' <ul class="select2-results filter-dropdown-container" role="listbox" id="select2-results-6" style="display:none; position: absolute; top: 33px; left: 8px; z-index: 1000; background: white; border: 1px solid #ddd; border-radius: 3px; "> <li ref="newFilter" class="select2-results-dept-0 select2-result select2-result-selectable select2-result-border-bottom " role="presentation"> <div class="select2-result-label" id="select2-result-label-7" role="option"> <div class="select2-icon-prepend" data-id="create"> <span class="select2-match"></span> <i class="fa fa-plus"></i> New Filter </div></div></li><li class="select2-highlighted select2-results-dept-0 select2-result select2-result-selectable select2-result-border-top" role="presentation"> <div class="select2-result-label" id="select2-result-label-8" role="option"> <div class="select2-icon-prepend" data-id="all_records"> <span class="select2-match"></span> <i class="fa fa-check"></i> All Opportunities </div></div></li><li class="select2-results-dept-0 select2-result select2-result-selectable" role="presentation"> <div class="select2-result-label" id="select2-result-label-9" role="option"> <div class="select2-no-icon" data-id="assigned_to_me"> <span class="select2-match"></span> My Favorites </div></div></li><li class="select2-results-dept-0 select2-result select2-result-selectable" role="presentation"> <div class="select2-result-label" id="select2-result-label-10" role="option"> <div class="select2-no-icon" data-id="favorites"> <span class="select2-match"></span> My Opportunities </div></div></li><li class="select2-results-dept-0 select2-result select2-result-selectable" role="presentation"> <div class="select2-result-label" id="select2-result-label-11" role="option"> <div class="select2-no-icon" data-id="recently_created"> <span class="select2-match"></span> Recently Created </div></div></li><li class="select2-results-dept-0 select2-result select2-result-selectable" role="presentation"> <div class="select2-result-label" id="select2-result-label-12" role="option"> <div class="select2-no-icon" data-id="recently_viewed"> <span class="select2-match"></span> Recently Viewed </div></div></li></ul>',filter_controls_advanced_row='<div class="filter-body fields FilterControlsAdvancedRow" > <div class="row-fluid"> <div class="row-fluid variable span12"> <div class="controls span3"> <span class="details row-one"> <input index="" data-type="" class=""/> </span> </div><div class="controls span3"> <span class="details row-two"> <input index="" class=""/> </span> </div><div class="controls span6"> <span class="details row-three"> <input index="" class=""> </span> </div><div class="hide controls span4"></div><div class="hide controls span4"></div><div class="filter-actions btn-group"> <button class="btn btn-invisible btn-dark" ref="filterRowMinus"><i class="fa fa-minus" ></i></button> <button class="btn btn-invisible btn-dark" ref="filterRowPlus"><i class="fa fa-plus"></i></button> <button class="fa-plus-helper btn btn-invisible btn-dark" ref="filterRowPlusGroup"><i class="fa fa-sign-out"></i></button></div></div><div ref="filterOperator" class="span1 operator row-operator hidden"><span class="row-operator-details details"><aside class="misc-group-helper"></aside><input class=""></span></div></div></div>',filter_controls_advanced_query='<div class="filter-body fields FilterControlsAdvancedRowQuery"> <div class="row-fluid"> <div class="row-fluid"> <div class="controls span12"> <span class="detail row-three"><i class="fa fa-check-circle"></i><input class="queryInput" ref="queryInput" ><i class="fa fa-info-circle"></i></span></div><div class="hide controls span4"></div><div class="hide controls span4"></div><div class="filter-actions btn-group">&nbsp;</div></div></div></div>',filter_controls_advanced_labels='<div class="filter-body labels FilterControlsAdvancedLabels" > <div class="row-fluid"> <div class="row-fluid"> <div class="controls span3"> <span class="detail"> <label>Select field</label> </span> </div><div class="controls span3"> <span class="details"> <label>Select operator</label> </span> </div><div class="controls span6"> <span class="detail"> <label>Select value</label> </span> </div></div></div></div>',filter_header_components='<div class="controls span6"> <label>Filter name</label> <input ref="newFilterName" type="text" class="inherit-width" placeholder="Enter new filter name…" > </div><div class="actions span6"> <div class="pull-right"> <a class="btn btn-link btn-invisible reset_button hide" >Reset</a> <a class="btn btn-link btn-invisible filter-option-advanced" ref="filterAdvanced">Advanced</a> <a class="btn btn-link btn-invisible filter-option-clear-values" ref="filterClear" >Clear values</a> <a class="btn btn-link btn-invisible filter-close" ref="filterClose">Cancel</a> <a class="btn btn-link btn-invisible delete_button hide" ref="filterDelete" >Delete</a> <a class="btn btn-primary disabled save_button" ref="filterSave">Save</a> </div></div>',filter_fake_select2_before='<div class=" hidden fake-select2 select2-drop select2-display-none select2-with-searchbox select2-drop-active" style="" id="select2-drop"><div class="select2-search"><label for="s2id_autogen8_search" class="select2-offscreen"></label><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="select2-input select2-focused" role="combobox" aria-expanded="true" aria-autocomplete="list" aria-owns="select2-results-8" id="s2id_autogen8_search" placeholder="" aria-activedescendant="select2-result-label-76"></div><ul class="select2-results" role="listbox" id="select2-results-8">',filter_fake_select2_after="</ul></div>";
