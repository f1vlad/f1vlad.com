(function(){console.log("AI Consumer: Initializing Chat UI v13 (Portable)...");const w=document.currentScript||document.querySelector('script[src*="front-ai-consumer.js"]'),v=w?w.src:window.location.href,E=v.substring(0,v.lastIndexOf("/")+1),m=document.createElement("link");m.rel="stylesheet",m.href=E+"front-ai-consumer-min.css",document.head.appendChild(m);let h=!1;const c=document.createElement("div");c.id="fai-chat-root";const s=document.createElement("div");s.className="fai-window";const f=document.createElement("div");f.className="fai-header",f.innerHTML=`
        <div class="fai-title">
            <div class="fai-status-dot"></div>
            AI Assistant (Offline)
        </div>
    `;const d=document.createElement("div");d.className="fai-messages";const g=document.createElement("div");g.className="fai-message agent",g.textContent="Hello! I'm your offline assistant. I can specific commands like 'Add [task]', 'Delete [task]', or 'Resolve [task]'.",d.appendChild(g);const r=document.createElement("div");r.className="fai-input-area";const o=document.createElement("textarea");o.className="fai-input",o.placeholder="Type a command...",o.rows=1;const p=document.createElement("button");p.className="fai-send-btn",p.innerHTML='<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>',r.appendChild(o),r.appendChild(p),s.appendChild(f),s.appendChild(d),s.appendChild(r);const i=document.createElement("button");i.className="fai-toggle-btn",i.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>',c.appendChild(s),c.appendChild(i),document.body.appendChild(c);function T(){h=!h,h?(s.classList.add("visible"),i.classList.add("open"),i.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',setTimeout(()=>o.focus(),100)):(s.classList.remove("visible"),i.classList.remove("open"),i.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>')}function n(a,t){const e=document.createElement("div");e.className=`fai-message ${t}`,e.textContent=a,d.appendChild(e),d.scrollTop=d.scrollHeight}function C(a){const t=a.toLowerCase().trim();if(/^(add|create|new)/.test(t)){let e=t.replace(/^(add|create|new)\s+/,"");if(e=e.replace(/^(a\s+)?(note|task|todo)\s+(to\s+)?/g,""),e)return{type:"ADD_TODO",payload:e}}if(/^(delete|remove)/.test(t)){let e=t.replace(/^(delete|remove)\s+/,"");if(e=e.replace(/^(a\s+)?(note|task|todo)\s+(to\s+)?/g,""),e)return{type:"DELETE_TODO",payload:e}}if(/^(resolve|complete|finish|check|done)/.test(t)){let e=t.replace(/^(resolve|complete|finish|check|done)\s+/,"");if(e=e.replace(/^(with\s+)?(a\s+)?(note|task|todo)\s+(to\s+)?/g,""),e)return{type:"RESOLVE_TODO",payload:e}}return t.includes("show")||t.includes("list")||t.includes("what are my todos")?{type:"LIST_TODOS"}:{type:"UNKNOWN"}}async function y(a,t){const u=(window.__CURRENT_TODOS__||await a["api.getTodos"]()).find(l=>l.title.toLowerCase().includes(t)||t.includes(l.title.toLowerCase()));return u||null}async function O(a){if(!window.__APP_MANIFEST__){n("Error: App not fully loaded.","agent");return}const t=window.__APP_MANIFEST__.endpoints;switch(a.type){case"ADD_TODO":n(`Intent: ADD "${a.payload}"`,"agent"),t["api.addTodo"]&&(await t["api.addTodo"](a.payload),n(`\u2705 Added task: "${a.payload}"`,"agent"),window.dispatchEvent(new CustomEvent("ai:todo-added",{detail:{title:a.payload}})));break;case"DELETE_TODO":if(n(`Intent: DELETE "${a.payload}"`,"agent"),t["api.deleteTodo"]&&t["api.getTodos"]){const e=await y(t,a.payload);e?(await t["api.deleteTodo"](e.id),n(`\u{1F5D1}\uFE0F Deleted task: "${e.title}"`,"agent"),window.dispatchEvent(new CustomEvent("ai:todo-deleted",{detail:{id:e.id}}))):n(`\u274C Check failed: Could not find task "${a.payload}"`,"agent")}break;case"RESOLVE_TODO":if(n(`Intent: COMPLETE "${a.payload}"`,"agent"),t["api.updateTodo"]&&t["api.getTodos"]){const e=await y(t,a.payload);e?(await t["api.updateTodo"](e.id,{completed:!0}),n(`\u{1F389} Completed task: "${e.title}"`,"agent"),window.dispatchEvent(new CustomEvent("ai:todo-completed",{detail:{id:e.id}}))):n(`\u274C Check failed: Could not find task "${a.payload}"`,"agent")}break;case"LIST_TODOS":if(t["api.getTodos"]){const u=(await t["api.getTodos"]()).slice(0,5).map(l=>(l.completed?"\u2705 ":"\u2022 ")+l.title).join(`
`);n(`Here are your top 5 tasks:
${u}`,"agent")}break;default:n("I didn't understand. Try 'Add param', 'Delete param', or 'Resolve param'.","agent")}}async function k(){const a=o.value.trim();if(!a)return;n(a,"user"),o.value="",o.style.height="auto";const t=C(a);await O(t)}i.addEventListener("click",T),p.addEventListener("click",k),o.addEventListener("keydown",a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),k())}),o.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"})})();
